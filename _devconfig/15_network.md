---
layout: page_collection
title: How do I PIV enable my network logon?
collection: devconfig
permalink: devconfig/15_network/
---
<script>
$(function() {
  $( "#accordion" ).accordion({
    heightStyle: "content",
    collapsible: "true",
    active: "false"
  });
});
</script>
#### Overview
This guide will take you through the steps necessary to configure your Windows based computer network to accept and potentially require PIV cards for authentication.

##### Assumptions
*  Your organization users are currently issued PIV cards
*  Your organization is using Microsoft Active Directory to manage your Windows network users
*  Your organization is using Microsoft Windows Server 2008 R2 or 2012
    *  Concepts will likely remain applicable to other versions of Windows Server, however, specific instructions may require modification
*  Your organization's systems are configured to automatically receive certificate updates via auto-enrollment or some other technique

#### Before you get started
The following reference information may be useful or required for configuring your systems depending on your architecture. Some information will need to be obtained from the appropriate organization.

*  CA Certificate that signed the authentication certificates
    *  The Federal PKI [Federal Common Policy CA Certificate](http://http.fpki.gov/fcpca/fcpca.crt) - the root CA Certificate created by the Federal PKI Management Authority (FPKIMA)
    *  Subordinate CAs in the chain including the Certification Authority that issued the certificates - If your agency issues your certificates, it will be your agency's CA certificate. If your agency's certificates are generated by another organization, such as a managed service, you'll need to acquire it from them.
*  Certificate Revocation Lists (CRL)
    *  The FPKI
        *  [CRL over HTTP](http://http.fpki.gov/fcpca/fcpca.crl)
        *  [CRL over LDAP](ldap://ldap.fpki.gov/cn=Federal%20Common%20Policy%20CA,ou=FPKI,o=U.S. %20Government,c=US)
    *  The CRL of the Certification Authority that issued your agency's certificates.

<!-- *  Authority Information Access (AIA) Locations
    *  The FPKI
        *  [AIA over HTTP](http://http.fpki.gov/fcpca/caCertsIssuedTofcpca.p7c)
        *  [AIA over LDAP](ldap://ldap.fpki.gov/cn=Federal%20Common%20Policy%20CA,ou=FPKI,o=U.S. %20Government,c=US)
    *  The AIA of the Certification Authority that issued your agency's certificates. -->

#### Complete the following tasks
<div id="accordion" markdown="1">

### Add the CA Certificates to the Trusted Root Certification Authorities
<div markdown="1">

The root certificate and intermediate CA certs are required by the domain controller to establish a chain of trust between the parent CA and the end users and applications. This allows the domain controller to issue trusted certificates to PIV cards within the directory and confirm the validity of smart card certificates during an access attempt.

Active Directory must be configured to trust a certification authority to authenticate users based on certificates from that CA. Both Smartcard workstations and domain controllers must be configured with correctly configured certificates.

This task will configure Active Directory to trust the Certification Authority chain that signed the users' authentication certificates. To configure Active Directory with the signing CA Certificate chain:

1.	On your Active Directory Domain Controller server, select **Active Directory Users and Computers**
2.	In the **Management Console**, right click the **Domain** and click **Properties**
3.	Once you're on the **Group Policy Tab**, click **Open** to open the **Group Policy Management Console plug-in**
4.	Right Click **Default Domain Policy** and click **Edit**
5.	Expand the **Computer Configuration** section and open **Windows Settings > Security Settings > Public Key**
6.	Right click **Trusted Root Certification Authorities** and select **Import**
7.	Follow the prompts in the Wizard to import the **Root Certificate** for the CA and click OK

From here, follow these steps to import the intermediate certificate(s):

1.	Right click **Intermediate Certification Authorities** and select **Import**
2.	Follow the prompts in the Wizard to import the **Intermediate Certificate(s)** for the CA and click OK

</div>

### Request and install Domain Controller certificates
<div markdown="1">
Work with the Federal Public Key Infrastructure management team to request a domain controller certificate for your domain controller(s). Each domain controller that is going to authenticate smartcard users must have a domain controller certificate.  

The certificate for each domain controller must meet the following specific format requirements:

*  The certificate must have a CRL distribution-point extension that points to a valid certificate revocation list (CRL).
    *  Optionally, the certificate Subject section should contain the directory path of the server object (the distinguished name), for example:

            CN=controller1.agency.gov OU=Domain Controllers DC=agency DC=gov

    *  The certificate Key Usage section must contain:

            Digital Signature, Key Encipherment

    *  Optionally, the certificate Basic Constraints section should contain:

            [Subject Type=End Entity, Path Length Constraint=None]

    *  The certificate Enhanced Key Usage section must contain:

            Client Authentication (1.3.6.1.5.5.7.3.2)
            Server Authentication (1.3.6.1.5.5.7.3.1)

    *  The certificate Subject Alternative Name section must contain the Domain Name System (DNS) name. If SMTP replication is used, the certificate Subject Alternative Name section must also contain the globally unique identifier (GUID) of the domain controller object in the directory.
        *  To determine the Domain Controller GUID, start Ldp.exe and locate the domain-naming context. Double-click the name of the domain controller that you want to view. The list of attributes for that object contains "Object GUID" followed by a long number. The number is the GUID for that object. For example:

                Other Name: 1.3.6.1.4.1.311.25.1 = ac 4b 29 06 bb d6 5d 4f e3 9c 4c ab c3 6a 55 d9 DNS Name=controller1.agency.gov

    *  The certificate template must have an extension that has the BMP data value "DomainController."

            Note The dsstore.exe -dcmon command does not recognize the certificate without one of these extensions.

    *  You must use the Schannel cryptographic service provider (CSP) to generate the key.
*  The domain controller certificate must be installed in the local computer's certificate store.

[291010](https://support.microsoft.com/en-us/kb/291010) Requirements for domain controller certificates from a third-party CA
</div>

### Publish the CA Certificates to the NTAuth Store
<div markdown="1">

By publishing the CA certificate to the enterprise NTAuth store, the system administrator indicates that the CA is trusted to issue certain certificates. This allows the correct certificates to be issued to smartcards and thus enables logon through PIV card authentication.

This task will configure Active Directory to trust the CA chain that signed the users' authentication certificates. To configure Active Directory with the signing CA Certificate chain:

1.	On the Active Directory Domain Controller, launch an **elevated command prompt** to use the **certutil** utility
2.	To **Publish the Certificate** to the **Enterprise NTAuth store** type

        certutil –dpublish –f "path_to_root_CA_cert" NTAuthCA

3.	The CA is now trusted to issue certificates of this type

</div>

### Associate PIV Credentials with Active Directory Accounts (AltSecID)
<div markdown="1">

> TODO
{:class="warning"}

</div>

### Configure group policies for PIV Authentication
<div markdown="1">

This task describes 2 common configurations related to domain Group Policy Objects (GPO).

|  scforceoption  |  This security policy setting requires users to log on to a computer by using a smart card.  |  Enabled / Disabled  |
|  scremoveoption  |  This setting determines what happens when the smart card for a logged-on user is removed from the smart card reader.  |  No Action / Lock Workstation / Force Logoff / Disconnect if a Remote Desktop Services session  |

**scforceoption** directs client Windows computers to enforce PIV logon for users. It is important to understand the ramifications of executing this step.

When you select the Smart Card is required for interactive logon check box in the Active Directory (AD) user account properties, Windows automatically resets the user password to a random complex password. In addition, Windows adds the SMARTCARD_REQUIRED flag to the UserAccountControl user account attribute and sets the DONT_EXPIRE_PASSWORD flag on the user account. The latter ensures that the user's password never expires after the Smart Card is required for interactive logon option is selected.

When a user logs on to Windows either locally or remotely using a Remote Desktop session, the Windows client automatically checks for the presence of the SMARTCARD_REQUIRED flag. If the Smart Card is required for interactive logon option is set for the user, Windows rejects the logon attempt if it's not made with smart card credentials.

Again, upon activation of scforceoption, users will **no longer know the password** to their account and will be **required** to use their PIV for authentication. Care should be used if enabling this option.

To enable or disable either of these policies:

1.  Open the Group Policy Management Console
1.  In the GPMC console tree, double-click Group Policy Objects in the forest and domain containing the GPO that you want to edit.
1.  Right-click the GPO, and then click Edit.
1.  In the console tree, edit the settings as appropriate.

</div>
</div>

#### References

Elements of this guide were derived from a [Microsoft Knowledgebase Article](https://support.microsoft.com/en-us/kb/281245)
